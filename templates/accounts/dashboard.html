{% extends 'base.html' %}

{% block title %}Dashboard | KeystoneBid{% endblock %}

{% block content %}
<section style="display: grid; gap: 1rem;">
    <article class="card">
        <h1 style="margin-bottom: 0.5rem;">Welcome, {{ user.username }}</h1>
        <p style="color: var(--color-muted); margin-bottom: 0.75rem;">
            Active listings: {{ active_listings_count }} | Active winning bids: {{ winning_bids_count }}
        </p>
        {% if user.profile.email_verified %}
            <span class="badge badge-active">Email verified</span>
        {% else %}
            <span class="badge badge-expired">Email not verified</span>
        {% endif %}
    </article>

    <article class="card">
        <h2 style="font-size: 1.2rem; margin-bottom: 0.6rem;">Pending Payments</h2>
        {% for order in pending_payments %}
            <p style="margin-bottom: 0.45rem;">
                <a href="{% url 'orders:detail' order.pk %}">{{ order.listing.title }}</a> - ${{ order.total_amount }}
                <a href="{% url 'payments:checkout' order.pk %}" style="color: var(--color-aged-amber);">Pay now</a>
            </p>
        {% empty %}
            <p>No pending payments.</p>
        {% endfor %}
    </article>

    <article class="card">
        <h2 style="font-size: 1.2rem; margin-bottom: 0.6rem;">My Listings</h2>
        {% for listing in my_listings %}
            <p style="margin-bottom: 0.45rem;">
                <a href="{% url 'listings:detail' listing.id %}">{{ listing.title }}</a>
                ({{ listing.get_status_display }})
            </p>
        {% empty %}
            <p>No listings yet.</p>
        {% endfor %}
        <a href="{% url 'listings:my_listings' %}" style="color: var(--color-aged-amber);">View all listings</a>
    </article>

    <article class="card">
        <h2 style="font-size: 1.2rem; margin-bottom: 0.6rem;">Recent Bids</h2>
        {% for bid in my_bids %}
            <p style="margin-bottom: 0.45rem;">
                <a href="{% url 'listings:detail' bid.listing.id %}">{{ bid.listing.title }}</a> - ${{ bid.amount }}
                {% if bid.is_winning %}<strong>(winning)</strong>{% endif %}
            </p>
        {% empty %}
            <p>No bids yet.</p>
        {% endfor %}
        <a href="{% url 'bids:my_bids' %}" style="color: var(--color-aged-amber);">View all bids</a>
    </article>

    <article class="card">
        <h2 style="font-size: 1.2rem; margin-bottom: 0.6rem;">Recent Notifications</h2>
        {% for note in recent_notifications %}
            <p style="margin-bottom: 0.45rem;">
                {% if not note.is_read %}<strong>[Unread]</strong>{% endif %}
                {% if note.link_url %}
                    <a href="{% url 'notifications:go' note.pk %}">{{ note.message }}</a>
                {% else %}
                    {{ note.message }}
                {% endif %}
            </p>
        {% empty %}
            <p>No notifications.</p>
        {% endfor %}
        <a href="{% url 'notifications:center' %}" style="color: var(--color-aged-amber);">Open notifications center</a>
    </article>

    <article class="card">
        <h2 style="font-size: 1.2rem; margin-bottom: 0.6rem;">Recent Purchases</h2>
        {% for order in recent_purchases %}
            <p style="margin-bottom: 0.45rem;">
                <a href="{% url 'orders:detail' order.pk %}">{{ order.listing.title }}</a> - ${{ order.total_amount }} ({{ order.get_status_display }})
            </p>
        {% empty %}
            <p>No purchases yet.</p>
        {% endfor %}
    </article>

    <article class="card">
        <h2 style="font-size: 1.2rem; margin-bottom: 0.6rem;">Recent Sales</h2>
        {% for order in recent_sales %}
            <p style="margin-bottom: 0.45rem;">
                <a href="{% url 'orders:detail' order.pk %}">{{ order.listing.title }}</a> - ${{ order.total_amount }} ({{ order.get_status_display }})
            </p>
        {% empty %}
            <p>No sales yet.</p>
        {% endfor %}
    </article>

    <article class="card">
        <h2 style="font-size: 1.2rem; margin-bottom: 0.6rem;">Favorites</h2>
        {% for favorite in recent_favorites %}
            <p style="margin-bottom: 0.45rem;">
                {% if favorite.listing %}
                    <a href="{% url 'listings:detail' favorite.listing.pk %}">{{ favorite.listing.title }}</a>
                    ({{ favorite.listing.get_listing_type_display }})
                {% elif favorite.collection_item %}
                    {{ favorite.collection_item.title }} by
                    <a href="{% url 'accounts:profile' favorite.collection_item.owner.username %}">
                        {{ favorite.collection_item.owner.username }}
                    </a>
                {% endif %}
            </p>
        {% empty %}
            <p>No favorites yet.</p>
        {% endfor %}
        <a href="{% url 'favorites:list' %}" style="color: var(--color-aged-amber);">Open favorites</a>
    </article>
</section>
{% endblock %}
