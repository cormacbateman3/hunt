{% extends 'base.html' %}
{% load static %}

{% block title %}Browse Listings | KeystoneBid{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/pages/browse.css' %}">
{% endblock %}

{% block content %}
<section class="browse-layout">
    <aside class="card">
        <h1 style="font-size: 1.4rem; margin-bottom: 0.4rem;">{{ section_title }}</h1>
        <p style="color: var(--color-muted); margin-bottom: 0.9rem;">{{ section_description }}</p>
        <h2 style="font-size: 1.2rem; margin-bottom: 0.8rem;">Filters</h2>
        <form method="get" style="display: grid; gap: 0.75rem;">
            <div>
                <label class="form-label" for="search">Search</label>
                <input class="form-input" id="search" name="search" value="{{ filters.search }}">
            </div>
            <div>
                <label class="form-label" for="county_id">County</label>
                <select class="form-select" id="county_id" name="county_id">
                    <option value="">Any</option>
                    {% for county in counties %}
                        <option value="{{ county.id }}" {% if filters.county_id == county.id|stringformat:'s' %}selected{% endif %}>
                            {{ county.name }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label class="form-label" for="license_type_id">License type</label>
                <select class="form-select" id="license_type_id" name="license_type_id">
                    <option value="">Any</option>
                    {% for license_type in license_types %}
                        <option value="{{ license_type.id }}" {% if filters.license_type_id == license_type.id|stringformat:'s' %}selected{% endif %}>
                            {{ license_type.name }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label class="form-label" for="year_min">Year from</label>
                <input class="form-input" id="year_min" type="number" name="year_min" value="{{ filters.year_min }}">
            </div>
            <div>
                <label class="form-label" for="year_max">Year to</label>
                <input class="form-input" id="year_max" type="number" name="year_max" value="{{ filters.year_max }}">
            </div>
            <div>
                <label class="form-label" for="condition">Condition</label>
                <select class="form-select" id="condition" name="condition">
                    <option value="">Any</option>
                    <option value="poor" {% if filters.condition == 'poor' %}selected{% endif %}>Poor</option>
                    <option value="fair" {% if filters.condition == 'fair' %}selected{% endif %}>Fair</option>
                    <option value="good" {% if filters.condition == 'good' %}selected{% endif %}>Good</option>
                    <option value="very_good" {% if filters.condition == 'very_good' %}selected{% endif %}>Very Good</option>
                    <option value="excellent" {% if filters.condition == 'excellent' %}selected{% endif %}>Excellent</option>
                    <option value="mint" {% if filters.condition == 'mint' %}selected{% endif %}>Mint</option>
                </select>
            </div>
            <div style="display: flex; gap: 0.55rem;">
                <button class="btn-primary" type="submit">Apply</button>
                <a class="btn-secondary" href="{% url current_route_name %}">Reset</a>
            </div>
        </form>
    </aside>

    <section>
        <div style="display: grid; gap: 0.8rem;">
            {% for listing in page_obj %}
                {% include 'listings/_listing_card.html' %}
            {% empty %}
                <div class="card">
                    <p>No active listings found.</p>
                </div>
            {% endfor %}
        </div>

        {% if page_obj.paginator.num_pages > 1 %}
            <nav style="margin-top: 1rem; display: flex; gap: 0.75rem; align-items: center;">
                {% if page_obj.has_previous %}
                    <a class="btn-secondary" href="?{% if query_string %}{{ query_string }}&{% endif %}page={{ page_obj.previous_page_number }}">Previous</a>
                {% endif %}
                <span>Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
                {% if page_obj.has_next %}
                    <a class="btn-secondary" href="?{% if query_string %}{{ query_string }}&{% endif %}page={{ page_obj.next_page_number }}">Next</a>
                {% endif %}
            </nav>
        {% endif %}
    </section>
</section>
{% endblock %}
